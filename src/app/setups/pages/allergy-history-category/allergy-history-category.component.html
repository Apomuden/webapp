<div nz-row [nzGutter]=10>
  <div nz-col [nzXs]="{ span: 24}" [nzLg]="{ span: 11}">
    <nz-card>
      <button nz-button nzType="primary" (click)="showCreateCategoryModal()" class="m-t-10" style="float:right;">New <i
          nz-icon nzType="plus" nzTheme="outline"></i></button>
      <h3 [ngStyle]="{ margin: '16px 0' }">Allergy History Category</h3>
      <nz-modal [(nzVisible)]="createCategoryModalVisible" [nzTitle]="addCategoryModalTitle"
        [nzContent]="addCategoryModalContent" [nzFooter]="addCategoryModalFooter" (nzOnCancel)="closeCreateModal()">
        <ng-template #addCategoryModalTitle>
          Create Category
        </ng-template>

        <ng-template #addCategoryModalContent>
          <form [formGroup]="createCategoryForm">
            <nz-alert *ngIf="createModalError" nzType="error" [nzMessage]="createModalError" class="m-b-10" nzShowIcon>
            </nz-alert>
            <nz-row>
              <nz-form-item>
                <nz-form-label [nzXs]="8" nzRequired nzFor="name">Name</nz-form-label>
                <nz-form-control [nzSpan]="16">
                  <input type="text" nz-input formControlName="name" name="name" placeholder="Name" />
                </nz-form-control>
              </nz-form-item>
            </nz-row>
          </form>
        </ng-template>

        <ng-template #addCategoryModalFooter>
          <button nz-button nzType="default" (click)="closeCreateModal()">Cancel</button>
          <button nz-button nzType="primary" (click)="createCategory()" [nzLoading]="isCreatingCategory">Save</button>
        </ng-template>
      </nz-modal>
      <nz-modal [(nzVisible)]="updateModalVisible" [nzTitle]="updateModalTitle" [nzContent]="updateModalContent"
        [nzFooter]="updateModalFooter" (nzOnCancel)="closeUpdateModal()">
        <ng-template #updateModalTitle>
          Update Category
        </ng-template>
        <ng-template #updateModalContent>
          <form [formGroup]="updateForm">
            <nz-alert *ngIf="updateModalError" nzType="error" [nzMessage]="updateModalError" class="m-b-10" nzShowIcon>
            </nz-alert>
            <nz-row>
              <nz-form-item>
                <nz-form-label [nzXs]="8" nzRequired nzFor="name">Name</nz-form-label>
                <nz-form-control [nzSpan]="16">
                  <input type="text" nz-input formControlName="name" name="name" placeholder="Name" />
                </nz-form-control>
              </nz-form-item>
            </nz-row>
          </form>
        </ng-template>

        <ng-template #updateModalFooter>
          <button nz-button nzType="default" (click)="closeUpdateModal()">Cancel</button>
          <button nz-button nzType="primary" (click)="update()" [nzLoading]="isUpdating">Save</button>
        </ng-template>
      </nz-modal>
      <nz-modal [(nzVisible)]="addItemModalVisible" [nzTitle]="modalTitle" [nzContent]="modalContent"
        [nzFooter]="modalFooter" (nzOnCancel)="closeAddItemModal()">
        <ng-template #modalTitle>
          Create Item
        </ng-template>

        <ng-template #modalContent>
          <form [formGroup]="createItemForm">
            <nz-alert *ngIf="addItemModalError" nzType="error" [nzMessage]="addItemModalError" class="m-b-10"
              nzShowIcon>
            </nz-alert>
            <nz-row>
              <nz-form-item>
                <nz-form-label [nzXs]="8" nzRequired nzFor="name">Name</nz-form-label>
                <nz-form-control [nzSpan]="16">
                  <input type="text" nz-input formControlName="name" name="name" placeholder="Name" />
                </nz-form-control>
              </nz-form-item>
            </nz-row>
          </form>
        </ng-template>

        <ng-template #modalFooter>
          <button nz-button nzType="default" (click)="closeAddItemModal()">Cancel</button>
          <button nz-button nzType="primary" (click)="createItem()" [nzLoading]="isCreatingItem">Save</button>
        </ng-template>
      </nz-modal>
      <nz-skeleton [nzActive]="true" [nzLoading]="isLoadingCategories">
        <nz-table #categoriesTable [nzData]="categories" nzBordered [nzShowPagination]="'false'">
          <thead>
            <tr>
              <th>Category Name</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of categoriesTable.data; index as i">
              <td style="cursor: pointer;" (click)="getHistoryItems(data)">{{ data.name }}</td>
              <td>

                <button nz-button nzType="primary" (click)="showAddItemModal(data)" [nzSize]="'small'" class="m-r-10">
                  Add <i style="cursor: pointer;" nz-icon nzType="plus" nzTheme="outline"
                    style="cursor: pointer;"></i></button>
                <button nz-button nzType="default" (click)="showEditModal(data)" [nzSize]="'small'" class="m-r-10">
                  Edit <i style="cursor: pointer;" nz-icon nzType="edit" nzTheme="outline"
                    style="cursor: pointer;"></i></button>
                <button nz-button nzType="default" [nzSize]="'small'" nz-popconfirm
                  nzPopconfirmTitle="Are you sure delete this?" nzPopconfirmPlacement="bottom"
                  (nzOnConfirm)="deleteCategory(data)">Delete <i nz-icon nzType="delete" nzTheme="fill"
                    style="color:red;font-size: 16px;"></i></button>

              </td>
            </tr>
          </tbody>
        </nz-table>
      </nz-skeleton>
    </nz-card>
  </div>
  <div nz-col [nzXs]="{ span: 24}" [nzLg]="{ span: 11 }">
    <nz-card *ngIf="selectedCategory">
      <h3 [ngStyle]="{ margin: '16px 0' }">Allergy History List For {{selectedCategory.name}}</h3>
      <nz-skeleton [nzActive]="true" [nzLoading]="isLoadingItems">
        <nz-list [nzDataSource]="categoryList" nzBordered [nzItemLayout]="'horizontal'" [nzRenderItem]="item"
          nzSize="small">
          <ng-template #item let-item>
            <nz-list-item [nzActions]="item.loading ? [] : [deleteAction]">
              <nz-skeleton [nzActive]="true" [nzTitle]="false" [nzLoading]="item.loading">
                <!-- <ng-template #editAction><a (click)="showModal(item)">edit</a></ng-template> -->
                <ng-template #deleteAction>
                  <a nz-popconfirm nzPopconfirmTitle="Are you sure delete this?" nzPopconfirmPlacement="bottom"
                    (nzOnConfirm)="deleteItem(item)"><i nz-icon nzType="delete" nzTheme="fill"
                      style="color:red;font-size: 16px;"></i></a>
                </ng-template>
                <nz-list-item-meta [nzTitle]="nzTitle">
                  <ng-template #nzTitle>
                    <a>{{ item.name }}</a>
                  </ng-template>
                </nz-list-item-meta>
              </nz-skeleton>
            </nz-list-item>
          </ng-template>
        </nz-list>
      </nz-skeleton>
    </nz-card>
  </div>
</div>
