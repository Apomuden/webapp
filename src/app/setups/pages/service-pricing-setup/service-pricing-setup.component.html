<div nz-row nzGutter="10">
  <nz-col nzSpan="12">
    <nz-card>
      <nz-list style="min-height: 350px;" [nzDataSource]="list" [nzItemLayout]="'horizontal'" [nzLoading]="initLoading"
        [nzRenderItem]="item">
        <ng-template #item let-item>
          <nz-list-item [nzActions]="item.loading ? [] : [deleteAction,editAction, moreAction]">
            <nz-skeleton [nzActive]="true" [nzTitle]="false" [nzLoading]="item.loading">
              <ng-template #editAction><a (click)="showModal(item)">edit</a></ng-template>
              <ng-template #deleteAction>
                <a nz-popconfirm nzPopconfirmTitle="Are you sure delete this?" nzPopconfirmPlacement="bottom"
                  (nzOnConfirm)="deleteServicePricing(item)"><i nz-icon nzType="delete" nzTheme="fill"
                    style="color:red;font-size: 16px;"></i></a>
              </ng-template>
              <ng-template #moreAction>
                <nz-switch [(ngModel)]="item.isActivated" (ngModelChange)="toggleItem($event, item)"></nz-switch>
              </ng-template>
              <nz-list-item-meta [nzTitle]="nzTitle" [nzDescription]="nzDesc">
                <ng-template #nzTitle>
                  <a>{{item.description}} </a>
                </ng-template>
                <ng-template #nzDesc>
                  <div>GHS {{item.prepaid_amount}} Prepaid</div>
                  <div>GHS {{item.postpaid_amount}} Postpaid</div>
                  <div>{{item.age_group_name}}</div>
                  <div>{{item.gender}}</div>
                </ng-template>
              </nz-list-item-meta>
            </nz-skeleton>
          </nz-list-item>
        </ng-template>
      </nz-list>
    </nz-card>
    <nz-modal [(nzVisible)]="isVisible" (nzOnCancel)="closeModal()" [nzTitle]="modalTitle" [nzContent]="modalContent"
      [nzFooter]="modalFooter">
      <ng-template #modalTitle>
        Update Service Pricing
      </ng-template>

      <ng-template #modalContent>
        <form [formGroup]="updateForm">
          <nz-alert *ngIf="modalError" nzType="error" [nzMessage]="modalError" class="m-b-10" nzShowIcon>
          </nz-alert>
          <nz-row>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="description">Description</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <input type="text" nz-input formControlName="description" name="description"
                  placeholder="Description" />
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="hospital_service_id">Hospital Service</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzAllowSearch="false" nzAllowClear="false" formControlName="hospital_service_id"
                  nzPlaceHolder="Hospital Service" [nzLoading]="isHospitalServicesLoading | async">
                  <nz-option *ngFor="let service of services" [nzLabel]="service.name" [nzValue]="service.id">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="service_category_id">Service Category</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzAllowSearch="false" nzAllowClear="false" formControlName="service_category_id"
                  nzPlaceHolder="Service Category" [nzLoading]="isLoadingServiceCategories | async">
                  <nz-option *ngFor="let serviceCategory of serviceCategoriesForModal" [nzLabel]="serviceCategory.name"
                    [nzValue]="serviceCategory.id">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="service_subcategory_id">Sub-Category</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzAllowSearch="false" nzAllowClear="false" formControlName="service_subcategory_id"
                  nzPlaceHolder="Service Sub Category" [nzLoading]="isLoadingServiceSubCategories | async">
                  <nz-option *ngFor="let serviceSubCategory of serviceSubCategoriesForModal"
                    [nzLabel]="serviceSubCategory.name" [nzValue]="serviceSubCategory.id">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="age_group_id">Age Group</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzAllowSearch="false" nzAllowClear="false" formControlName="age_group_id"
                  nzPlaceHolder="Age Group" [nzLoading]="isAgeGroupsLoading | async">
                  <nz-option *ngFor="let ageGroup of ageGroups" [nzLabel]="ageGroup.name" [nzValue]="ageGroup.id">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="gender">Gender</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzAllowSearch="false" nzMode="multiple" [nzTokenSeparators]="[',']" nzAllowClear=" false"
                  formControlName="gender" nzPlaceHolder="Gender">
                  <nz-option nzValue="MALE" nzLabel="Male"></nz-option>
                  <nz-option nzValue="FEMALE" nzLabel="Female"></nz-option>
                  <nz-option nzValue="BIGENDER" nzLabel="Bigender"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="status">Status</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzAllowSearch="false" nzAllowClear="false" formControlName="status" nzPlaceHolder="Status">
                  <nz-option nzLabel="ACTIVE" nzValue="ACTIVE"></nz-option>
                  <nz-option nzLabel="INACTIVE" nzValue="INACTIVE"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="patient_status">Patient Status</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <nz-select nzAllowSearch="false" nzMode="tags" nzAllowClear="false" [nzTokenSeparators]="[',']"
                  formControlName="patient_status" nzPlaceHolder="Patient status">
                  <nz-option nzLabel="IN-PATIENT" nzValue="IN-PATIENT"></nz-option>
                  <nz-option nzLabel="OUT-PATIENT" nzValue="OUT-PATIENT"></nz-option>
                  <nz-option nzLabel="WALK-IN" nzValue="WALK-IN"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="prepaid_amount">Prepaid Amount</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <input nz-input type="number" formControlName="prepaid_amount" placeholder="Prepaid amount in GHS" />
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzXs]="8" nzRequired nzFor="postpaid_amount">Postpaid Amount</nz-form-label>
              <nz-form-control [nzSpan]="16">
                <input nz-input type="number" formControlName="postpaid_amount" placeholder="Postpaid amount in GHS" />
              </nz-form-control>
            </nz-form-item>
          </nz-row>
        </form>
      </ng-template>

      <ng-template #modalFooter>
        <button nz-button (click)="closeModal()">Cancel</button>
        <button nz-button nzType="primary" (click)="update()" [nzLoading]="isUpdatingServicePricing|async">Save</button>
      </ng-template>
    </nz-modal>
  </nz-col>
  <nz-col nzSpan="8">
    <nz-card>
      <h5>Create Service</h5>
      <form (ngSubmit)="submitForm()" [formGroup]="servicePricingForm">
        <nz-alert *ngIf="error" nzType="error" nzMessage="Error" [nzDescription]="error">
        </nz-alert>
        <nz-row class="m-b-10">
          <nz-form-control [nzSpan]="24">
            <input type="text" nz-input formControlName="description" placeholder="Description" />
          </nz-form-control>
        </nz-row>
        <nz-row class="m-b-10">
          <nz-form-control [nzSpan]="24">
            <nz-select nzAllowSearch="false" nzAllowClear="false" name="hospital_service_id"
              [nzLoading]="isHospitalServicesLoading | async" formControlName="hospital_service_id"
              nzPlaceHolder="Hospital Service">
              <nz-option *ngFor="let service of services" [nzLabel]="service.name" [nzValue]="service.id"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-row>
        <nz-row class="m-b-10">
          <nz-form-control [nzSpan]="24">
            <nz-select nzAllowSearch="false" nzAllowClear="true" name="service_category_id"
              [nzLoading]="isServiceCategoriesLoading | async" formControlName="service_category_id"
              nzPlaceHolder="Service Category">
              <nz-option *ngFor="let serviceCategory of serviceCategories" [nzLabel]="serviceCategory.name"
                [nzValue]="serviceCategory.id"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-row>
        <nz-row class="m-b-10">
          <nz-form-control [nzSpan]="24" *ngIf="this.servicePricingForm.get('service_category_id').value != null">
            <nz-select nzAllowSearch="false" nzAllowClear="false" name="service_subcategory_id"
              [nzLoading]="isServiceSubCategoriesLoading | async" formControlName="service_subcategory_id"
              nzPlaceHolder="Service Sub Category">
              <nz-option *ngFor="let servicesub of serviceSubCategories" [nzLabel]="servicesub.name"
                [nzValue]="servicesub.id"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-row>

        <nz-row class="m-b-10">
          <nz-select nzAllowSearch="false" nzMode="tags" nzAllowClear="false" [nzTokenSeparators]="[',']"
            formControlName="patient_status" nzPlaceHolder="Patient status">
            <nz-option nzLabel="IN-PATIENT" nzValue="IN-PATIENT"></nz-option>
            <nz-option nzLabel="OUT-PATIENT" nzValue="OUT-PATIENT"></nz-option>
            <nz-option nzLabel="WALK-IN" nzValue="WALK-IN"></nz-option>
          </nz-select>
        </nz-row>

        <nz-row class="m-b-10">
          <nz-select nzAllowSearch="false" nzAllowClear="false" formControlName="status" nzPlaceHolder="Status">
            <nz-option nzLabel="ACTIVE" nzValue="ACTIVE"></nz-option>
            <nz-option nzLabel="INACTIVE" nzValue="INACTIVE"></nz-option>
          </nz-select>
        </nz-row>
        <nz-row class="m-b-10">
          <nz-form-control [nzSpan]="24">
            <input nz-input type="number" formControlName="prepaid_amount" placeholder="prepaid amount in GHS" />
          </nz-form-control>

        </nz-row>
        <nz-row class="m-b-10">
          <nz-form-control [nzSpan]="24">
            <input nz-input type="number" formControlName="postpaid_amount" placeholder="Postpaid amount in GHS" />
          </nz-form-control>

        </nz-row>



        <nz-row class="m-b-10">
          <nz-select nzAllowSearch="false" nzMode="tags" nzAllowClear="false" [nzTokenSeparators]="[',']"
            formControlName="gender" nzPlaceHolder="Gender">
            <nz-option nzLabel="MALE" nzValue="MALE"></nz-option>
            <nz-option nzLabel="FEMALE" nzValue="FEMALE"></nz-option>
            <nz-option nzLabel="BIGENDER" nzValue="BIGENDER"></nz-option>
          </nz-select>
        </nz-row>

        <nz-row class="m-b-10">
          <nz-select nzAllowSearch="false" nzAllowClear="false" formControlName="age_group_id" nzPlaceHolder="Age Group"
            [nzLoading]="isAgeGroupsLoading | async">
            <nz-option *ngFor="let ageGroup of ageGroups" [nzLabel]="ageGroup.name" [nzValue]="ageGroup.id"></nz-option>
          </nz-select>
        </nz-row>
        <nz-row>
          <nz-form-control nzSpan="24" style="text-align: right;" class="m-t-10">
            <button nz-button nzType="primary" type="submit" [nzLoading]="isCreatingServicePricing | async">
              Submit
            </button>
          </nz-form-control>
        </nz-row>
      </form>
    </nz-card>
  </nz-col>
</div>
