<nz-card>
  <form nz-form nzLayout="vertical" [formGroup]="requestForm">
    <div nz-row *ngIf="patient">
      <nz-descriptions nzSize="small" nzBordered [nzColumn]="{ xxl: 4, xl: 3, lg: 3, md: 3, sm: 2, xs: 1 }">
        <nz-descriptions-item nzTitle="Folder #">
          {{patient.folder_no}}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Name">
          {{patient.firstname}} {{patient.middlename}} {{patient.surname}}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Gender">
          {{patient.gender}}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Age">
          {{patient.age}} {{ageUnit}}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Patient Status">
          {{patient.reg_status}}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Funding Type">
          {{patient.funding_type_name}}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Sponsor">
          {{patient.sponsorship_type_name}}
        </nz-descriptions-item>

      </nz-descriptions>
    </div>
    <div nz-row [nzGutter]="24" *ngIf="!patient">
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label nzRequired nzFor="title">Folder #</nz-form-label>
          <nz-form-control nzHasFeedback nzErrorTip="Enter valid folder number">
            <input type="text" nz-input placeholder="A0000001/20a" formControlName="folderNumber" />
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <nz-divider></nz-divider>
    <div nz-row [nzGutter]="24" *ngIf="searchInitialized && !isLoadingData">
      <div nz-col [nzSpan]="12">
        <div nz-row>
          <div nz-col [nzSpan]="12">
            <nz-select [formControl]="appliesToReasonControl" nzPlaceHolder="Applies to reason">
              <nz-option nzValue="SERVICES" nzLabel="Services"></nz-option>
              <nz-option nzValue="MEDICINE" nzLabel="Medicine"></nz-option>
              <nz-option nzValue="ADMISSION" nzLabel="Admission"></nz-option>
            </nz-select>
          </div>
        </div>


      </div>
      <div nz-col nzOffset="12" [nzSpan]="6">
        <nz-form-item>
          <nz-form-label nzRequired nzFor="paymentChannel">Payment Channel</nz-form-label>
          <nz-form-control nzHasFeedback nzErrorTip="Please select payment channel">
            <nz-select name="paymentChannel" [compareWith]="compareFn" [nzLoading]="isLoadingPaymentChannels"
              [formControl]="paymentChannelControl" nzPlaceHolder="Payment Channel">
              <nz-option *ngFor="let channel of paymentChannels" [nzValue]="channel.id" [nzLabel]="channel.name">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label nzRequired nzFor="billed">Billed Sponsor</nz-form-label>
          <nz-form-control nzHasFeedback nzErrorTip="Please select billed sponsor">
            <nz-select nzShowSearch nzAllowClear [compareWith]="compareFn" nzPlaceHolder="Billed sponsor"
              [formControl]="billedFormControl" [nzLoading]="sponsorsLoading">
              <nz-option *ngFor="let permit of sponsorPermits" [nzLabel]="permit.billing_sponsor_name"
                [nzValue]="permit.id"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

      </div>
    </div>
    <h3 style="margin-top: 20px;" *ngIf="searchInitialized && !isLoadingData">Discount Details</h3>
    <div nz-row [nzGutter]="24" style="margin-top: 10px;" *ngIf="searchInitialized && !isLoadingData">
      <div nz-col [nzSpan]="5">
        <nz-form-item>
          <nz-form-label nzFor="totalBill">Total Bill</nz-form-label>
          <nz-form-control>
            <input nz-input placeholder="Total Bill" name="totalBill" disabled="true"
              [formControl]="totalBillControl" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="5">
        <nz-form-item>
          <nz-form-label nzRequired nzFor="discountType">Discount Type</nz-form-label>
          <nz-form-control nzHasFeedback nzErrorTip="Please select discount type">
            <nz-select name="discountType" [formControl]="discountTypeControl" nzPlaceHolder="Discount Type">
              <nz-option nzValue="p" nzLabel="Percentage(%)"></nz-option>
              <nz-option nzValue="f" nzLabel="Flat"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div *ngIf="discountTypeControl.value==='p'" nz-col [nzSpan]="5">
        <nz-form-item>
          <nz-form-label nzRequired nzFor="discountPercentage">Discount Percentage</nz-form-label>
          <nz-form-control nzHasFeedback nzErrorTip="Please type discount percentage">
            <input nz-input placeholder="Discount Percentage" type="number"
              [formControl]="discountValuePercentageControl" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div *ngIf="discountTypeControl.value==='f'" nz-col [nzSpan]="5">
        <nz-form-item>
          <nz-form-label nzRequired nzFor="discountAmount">Discount Amount</nz-form-label>
          <nz-form-control nzHasFeedback nzErrorTip="Please type discount amount">
            <input nz-input placeholder="Discount Amount" type="number" [formControl]="discountValueFlatControl" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="5">
        <nz-form-item>
          <nz-form-label nzRequired nzFor="discountBalance">Discount Balance</nz-form-label>
          <nz-form-control nzHasFeedback nzErrorTip="Please type discount balance">
            <input nz-input placeholder="Discount Balance" disabled="true" [formControl]="discountBalanceControl" />
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div style="margin-top:20px;margin-bottom: 20px; text-align: right;">
      <div style=" width:300px;display: inline-block;">
        <nz-descriptions nzSize="small" [nzColumn]="{ xxl: 1, xl: 1, lg: 1, md: 1, sm: 1, xs: 1 }">
          <nz-descriptions-item *ngIf="transactionDetails" nzTitle="Bill Due">
            {{(totalBillControl.value && totalBillControl.valid)?numeral(totalBillControl.value).format('0.00'):'N/A'}}
          </nz-descriptions-item>
        </nz-descriptions>
        <nz-descriptions nzSize="small" [nzColumn]="{ xxl: 1, xl: 1, lg: 1, md: 1, sm: 1, xs: 1 }">
          <nz-descriptions-item *ngIf="transactionDetails" nzTitle="Discount Amount">
            {{(discountAmountControl.value && discountAmountControl.valid)?numeral(discountAmountControl.value).format('0.00'):'N/A'}}
          </nz-descriptions-item>
        </nz-descriptions>
        <nz-descriptions nzSize="small" [nzColumn]="{ xxl: 1, xl: 1, lg: 1, md: 1, sm: 1, xs: 1 }">
          <nz-descriptions-item *ngIf="transactionDetails" nzTitle="Balance Due">
            {{((discountBalanceControl.value && discountBalanceControl.valid)||discountBalanceControl.value===0)?numeral(discountBalanceControl.value).format('0.00'):'N/A'}}
          </nz-descriptions-item>
        </nz-descriptions>
      </div>
    </div>




    <div nz-row [nzGutter]="24" *ngIf="searchInitialized && !isLoadingData">

    </div>
    <div nz-row>
      <div nz-col nzSpan="12" nzOffset="6" nzSm="24" *ngIf="!searchInitialized"><i nz-icon [nzType]="'info-circle'"
          class="m-r-5"></i> {{message}}
      </div>
    </div>
    <nz-skeleton [nzLoading]="isLoadingData && searchInitialized" [nzActive]="true">
    </nz-skeleton>
  </form>

  <nz-row nzType="flex" nzJustify="center" *ngIf="searchInitialized && !isLoadingData">
    <nz-col>
      <nz-button-group>
        <button nz-button nzType="danger" (click)="cancel()" [nzLoading]="requesting">Cancel</button>
        <button nz-button nzType="primary" (click)="done()" [nzLoading]="requesting">Done</button>
      </nz-button-group>
    </nz-col>
  </nz-row>
</nz-card>
